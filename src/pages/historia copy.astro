---
import storyData from "../data/story.json";
import CinemaLayout from "../layouts/cinemaLayout.astro";
import StoryContainer from "../components/storyContainer.astro";

const storyList = storyData.stories;
const initialStoryId = storyList[0].id;
---

<CinemaLayout title="Spooky Hackaton-Tu historia">
    <main class="flex flex-col items-center justify-center min-h-screen p-4">
        <div class="max-w-7xl w-full text-center">
            {
                storyList.map((story) => (
                    <div
                        id={`story-${story.id}`}
                        class="mb-6"
                        style="display: none;"
                    >
                        <StoryContainer
                            titulo={story.titulo}
                            texto={story.texto}
                        />
                    </div>
                ))
            }
            <div
                id="button-container"
                class="flex flex-wrap justify-center gap-4"
            >
                <!-- Buttons will be dynamically added here -->
            </div>
        </div>
    </main>
</CinemaLayout>

<script define:vars={{ storyList, initialStoryId }}>
    function displayStory(id) {
        const story = storyList.find((s) => s.id === id);
        if (story) {
            // Hide all story containers
            storyList.forEach((s) => {
                const container = document.getElementById(`story-${s.id}`);
                if (container) container.style.display = "none";
            });

            // Show the selected story container
            const selectedContainer = document.getElementById(`story-${id}`);
            if (selectedContainer) selectedContainer.style.display = "block";

            const buttonContainer = document.getElementById("button-container");
            buttonContainer.innerHTML = "";
            for (let i = 1; i <= 4; i++) {
                const labelKey = `label_button${i}`;
                const gotoKey = `goto_button${i}`;
                if (
                    story[labelKey] &&
                    story[gotoKey] &&
                    story[gotoKey] !== "none"
                ) {
                    const button = document.createElement("button");
                    button.textContent = story[labelKey];
                    button.addEventListener("click", () =>
                        displayStory(story[gotoKey]),
                    );
                    buttonContainer.appendChild(button);
                }
            }
        } else {
            console.error("Story not found");
        }
    }

    // Display the initial story on page load
    displayStory(initialStoryId);
</script>

<style>
    #button-container {
        display: flex;
        margin-top: 20px;
    }
</style>
