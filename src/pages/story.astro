---
import storyData from "../data/story.json";

const storyList = storyData.stories;
const initialStoryId = storyList[0].id;
---

<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Interactive Story</title>
    </head>
    <body>
        <div id="story-container">
            <!-- Story content will be displayed here -->
        </div>
        <div id="button-container">
            <!-- Buttons will be dynamically added here -->
        </div>

        <script define:vars={{ storyList, initialStoryId }}>
            function findStoryById(id) {
                return storyList.find((story) => story.id === id);
            }

            function displayStory(id) {
                const story = findStoryById(id);
                const storyContainer =
                    document.getElementById("story-container");
                const buttonContainer =
                    document.getElementById("button-container");

                if (story) {
                    storyContainer.innerHTML = `
                        <h2>${story.personaje}</h2>
                        <p>${story.texto}</p>
                    `;

                    buttonContainer.innerHTML = "";
                    for (let i = 1; i <= 4; i++) {
                        const labelKey = `label_button${i}`;
                        const gotoKey = `goto_button${i}`;
                        if (
                            story[labelKey] &&
                            story[gotoKey] &&
                            story[gotoKey] !== "none"
                        ) {
                            const button = document.createElement("button");
                            button.textContent = story[labelKey];
                            button.addEventListener("click", () =>
                                displayStory(story[gotoKey]),
                            );
                            buttonContainer.appendChild(button);
                        }
                    }
                } else {
                    storyContainer.innerHTML = "<p>Story not found</p>";
                    buttonContainer.innerHTML = "";
                }
            }

            // Display the initial story on page load
            displayStory(initialStoryId);
        </script>

        <style>
            #button-container {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 20px;
            }
            button {
                padding: 10px 20px;
                background-color: #4caf50;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                transition: background-color 0.3s;
            }
            button:hover {
                background-color: #45a049;
            }
        </style>
    </body>
</html>
