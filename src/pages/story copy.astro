---
import storyData from "../data/story.json";

const storyList = storyData.stories;
---

<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Story Viewer</title>
    </head>
    <body>
        <div id="story-container">
            <!-- Story content will be displayed here -->
        </div>
        <button id="next-button">Next</button>

        <script define:vars={{ storyList }}>
            let currentStoryId = storyList[0].id; // Start with the first story

            function findStoryById(id) {
                return storyList.find((story) => story.id === id);
            }

            function displayStory(id) {
                const story = findStoryById(id);
                const storyContainer =
                    document.getElementById("story-container");
                const nextButton = document.getElementById("next-button");

                if (story) {
                    storyContainer.innerHTML = `
                        <h2>${story.personaje}</h2>
                        <p>${story.texto}</p>
                    `;
                    currentStoryId = story.id;

                    // Disable the button if there's no next story or goto is "none"
                    if (story.goto === "none") {
                        nextButton.disabled = true;
                        nextButton.classList.add("cursor-not-allowed");
                    } else {
                        nextButton.disabled = false;
                        nextButton.classList.remove("cursor-not-allowed");
                    }
                } else {
                    storyContainer.innerHTML = "<p>End of story</p>";
                    nextButton.disabled = true;
                    nextButton.classList.add("cursor-not-allowed");
                }
            }

            document
                .getElementById("next-button")
                .addEventListener("click", () => {
                    const currentStory = findStoryById(currentStoryId);
                    if (currentStory && currentStory.goto !== "none") {
                        displayStory(currentStory.goto);
                    }
                });

            // Display the first story on page load
            displayStory(currentStoryId);
        </script>
    </body>
</html>
